name: 'Dashboard Test Cleanup'
description: 'Clean dashboard test artifacts with proper permissions'

inputs:
  test-dir:
    description: 'Path to the test directory'
    required: false
    default: 'packages/sleeper_detection/dashboard/tests'

runs:
  using: 'composite'
  steps:
    - name: Clean test artifacts
      shell: bash
      run: |
        if [ -d "${{ inputs.test-dir }}" ]; then
          echo "Cleaning up leftover test artifacts..."
          # Use Docker to clean with proper permissions
          docker run --rm -v $(pwd)/${{ inputs.test-dir }}:/workspace \
            -w /workspace busybox sh -c \
            "rm -rf __pycache__ sample_charts test_evaluation_results.db screenshots \
             baselines test-artifacts 2>/dev/null || true; \
             find . -type d -name '__pycache__' -exec rm -rf {} + 2>/dev/null || true"
        fi
