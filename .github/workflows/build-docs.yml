---
name: Build Documentation

on:
  push:
    paths:
      - 'packages/sleeper_agents/docs/**/*.tex'
      - 'docs/integrations/ai-services/**/*.tex'
      - 'docs/projections/latex/**/*.tex'
      - 'docs/philosophy/latex/**/*.tex'
      - 'docs/agents/**/*.tex'
      - 'automation/ci-cd/build-latex-doc.sh'
      - '.github/workflows/build-docs.yml'
  pull_request:
    paths:
      - 'packages/sleeper_agents/docs/**/*.tex'
      - 'docs/integrations/ai-services/**/*.tex'
      - 'docs/projections/latex/**/*.tex'
      - 'docs/philosophy/latex/**/*.tex'
      - 'docs/agents/**/*.tex'
      - 'automation/ci-cd/build-latex-doc.sh'
      - '.github/workflows/build-docs.yml'
  workflow_dispatch: {}

jobs:
  build-sleeper-agents-guide:
    name: Build Sleeper Agents Framework Guide
    runs-on: self-hosted
    timeout-minutes: 10
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi
          pdflatex --version

      - name: Build PDF with LaTeX
        run: |
          echo "Building Sleeper Agents Framework Guide..."
          mkdir -p docs_output
          cd packages/sleeper_agents/docs
          pdflatex -interaction=nonstopmode -output-directory=../../../docs_output Sleeper_Agents_Framework_Guide.tex
          pdflatex -interaction=nonstopmode -output-directory=../../../docs_output Sleeper_Agents_Framework_Guide.tex
          echo "PDF build completed"
          ls -la ../../../docs_output/

      - name: Verify and rename PDF
        run: |
          if [ -f docs_output/Sleeper_Agents_Framework_Guide.pdf ]; then
            echo "PDF successfully created"
            # Rename to sensible kebab-case filename
            mv docs_output/Sleeper_Agents_Framework_Guide.pdf docs_output/sleeper-agents-framework-guide.pdf
            ls -lh docs_output/sleeper-agents-framework-guide.pdf
          else
            echo "ERROR: PDF was not created"
            exit 1
          fi

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: sleeper-agents-framework-guide
          path: docs_output/sleeper-agents-framework-guide.pdf
          retention-days: 90

      - name: Cleanup build artifacts
        if: always()
        run: |
          rm -rf docs_output/*.aux docs_output/*.log docs_output/*.toc \
                 docs_output/*.out docs_output/*.fls docs_output/*.fdb_latexmk \
                 2>/dev/null || true

  build-agentcore-memory-guide:
    name: Build AgentCore Memory Integration Guide
    runs-on: self-hosted
    timeout-minutes: 10
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: |
          echo "Building AgentCore Memory Integration Guide..."
          mkdir -p docs_output
          cd docs/integrations/ai-services
          pdflatex -interaction=nonstopmode -output-directory=../../../docs_output AgentCore_Memory_Integration_Guide.tex
          pdflatex -interaction=nonstopmode -output-directory=../../../docs_output AgentCore_Memory_Integration_Guide.tex
          pdflatex -interaction=nonstopmode -output-directory=../../../docs_output AgentCore_Memory_Integration_Guide.tex
          echo "PDF build completed"
          ls -la ../../../docs_output/

      - name: Verify and rename PDF
        run: |
          if [ -f docs_output/AgentCore_Memory_Integration_Guide.pdf ]; then
            echo "PDF successfully created"
            # Rename to sensible kebab-case filename
            mv docs_output/AgentCore_Memory_Integration_Guide.pdf docs_output/agentcore-memory-integration-guide.pdf
            ls -lh docs_output/agentcore-memory-integration-guide.pdf
          else
            echo "ERROR: PDF was not created"
            exit 1
          fi

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: agentcore-memory-integration-guide
          path: docs_output/agentcore-memory-integration-guide.pdf
          retention-days: 90

      - name: Cleanup build artifacts
        if: always()
        run: |
          rm -rf docs_output/*.aux docs_output/*.log docs_output/*.toc \
                 docs_output/*.out docs_output/*.fls docs_output/*.fdb_latexmk \
                 2>/dev/null || true

  build-virtual-character-guide:
    name: Build Virtual Character System Guide
    runs-on: self-hosted
    timeout-minutes: 10
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: |
          echo "Building Virtual Character System Guide..."
          mkdir -p docs_output
          cd docs/integrations/ai-services
          latexmk -pdf -interaction=nonstopmode -output-directory=../../../docs_output Virtual_Character_System_Guide.tex
          echo "PDF build completed"
          ls -la ../../../docs_output/

      - name: Verify and rename PDF
        run: |
          if [ -f docs_output/Virtual_Character_System_Guide.pdf ]; then
            echo "PDF successfully created"
            # Rename to sensible kebab-case filename
            mv docs_output/Virtual_Character_System_Guide.pdf docs_output/virtual-character-system-guide.pdf
            ls -lh docs_output/virtual-character-system-guide.pdf
          else
            echo "ERROR: PDF was not created"
            exit 1
          fi

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: virtual-character-system-guide
          path: docs_output/virtual-character-system-guide.pdf
          retention-days: 90

      - name: Cleanup build artifacts
        if: always()
        run: |
          rm -rf docs_output/*.aux docs_output/*.log docs_output/*.toc \
                 docs_output/*.out docs_output/*.fls docs_output/*.fdb_latexmk \
                 2>/dev/null || true

  build-wmd-proliferation-report:
    name: Build AI Agents WMD Proliferation Report
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh ai-agents-wmd-proliferation.tex

      - name: Rename PDF to sensible filename
        run: |
          # Rename to include -report suffix for consistency
          mv docs_output/ai-agents-wmd-proliferation.pdf docs_output/ai-agents-wmd-proliferation-report.pdf
          ls -lh docs_output/ai-agents-wmd-proliferation-report.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: ai-agents-wmd-proliferation-report
          path: docs_output/ai-agents-wmd-proliferation-report.pdf
          retention-days: 90

  build-political-targeting-report:
    name: Build AI Agents Political Targeting Report
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh ai-agents-political-targeting.tex

      - name: Rename PDF to sensible filename
        run: |
          # Rename to include -report suffix for consistency
          mv docs_output/ai-agents-political-targeting.pdf docs_output/ai-agents-political-targeting-report.pdf
          ls -lh docs_output/ai-agents-political-targeting-report.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: ai-agents-political-targeting-report
          path: docs_output/ai-agents-political-targeting-report.pdf
          retention-days: 90

  build-espionage-operations-report:
    name: Build AI Agents Espionage Operations Report
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh ai-agents-espionage-operations.tex

      - name: Rename PDF to sensible filename
        run: |
          # Rename to include -report suffix for consistency
          mv docs_output/ai-agents-espionage-operations.pdf docs_output/ai-agents-espionage-operations-report.pdf
          ls -lh docs_output/ai-agents-espionage-operations-report.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: ai-agents-espionage-operations-report
          path: docs_output/ai-agents-espionage-operations-report.pdf
          retention-days: 90

  build-economic-actors-report:
    name: Build AI Agents Economic Actors Report
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh ai-agents-economic-actors.tex

      - name: Rename PDF to sensible filename
        run: |
          # Rename to include -report suffix for consistency
          mv docs_output/ai-agents-economic-actors.pdf docs_output/ai-agents-economic-actors-report.pdf
          ls -lh docs_output/ai-agents-economic-actors-report.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: ai-agents-economic-actors-report
          path: docs_output/ai-agents-economic-actors-report.pdf
          retention-days: 90

  build-financial-integrity-report:
    name: Build AI Agents Financial Integrity Report
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh ai-agents-financial-integrity.tex

      - name: Rename PDF to sensible filename
        run: |
          # Rename to include -report suffix for consistency
          mv docs_output/ai-agents-financial-integrity.pdf docs_output/ai-agents-financial-integrity-report.pdf
          ls -lh docs_output/ai-agents-financial-integrity-report.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: ai-agents-financial-integrity-report
          path: docs_output/ai-agents-financial-integrity-report.pdf
          retention-days: 90

  build-institutional-erosion-report:
    name: Build AI Agents Institutional Erosion Report
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh ai-agents-institutional-erosion.tex

      - name: Rename PDF to sensible filename
        run: |
          # Rename to include -report suffix for consistency
          mv docs_output/ai-agents-institutional-erosion.pdf docs_output/ai-agents-institutional-erosion-report.pdf
          ls -lh docs_output/ai-agents-institutional-erosion-report.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: ai-agents-institutional-erosion-report
          path: docs_output/ai-agents-institutional-erosion-report.pdf
          retention-days: 90

  build-architectural-qualia-paper:
    name: Build Architectural Qualia Paper
    runs-on: self-hosted
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: ./automation/ci-cd/build-latex-doc.sh architectural-qualia.tex docs/philosophy/latex

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: architectural-qualia-paper
          path: docs_output/architectural-qualia.pdf
          retention-days: 90

  build-agentic-workflow-handout:
    name: Build Agentic Workflow Handout
    runs-on: self-hosted
    timeout-minutes: 10
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 1
          clean: true

      - name: Install TeXLive
        run: |
          if ! command -v pdflatex &> /dev/null; then
            echo "Installing texlive..."
            sudo apt-get update
            sudo apt-get install -y texlive-latex-extra texlive-fonts-recommended texlive-xetex latexmk
          else
            echo "texlive already installed"
          fi

      - name: Build PDF with LaTeX
        run: |
          echo "Building Agentic_Workflow_Handout.pdf..."
          mkdir -p docs_output
          cd docs/agents
          pdflatex -interaction=nonstopmode -output-directory=../../docs_output Agentic_Workflow_Handout.tex
          echo "PDF build completed"
          ls -la ../../docs_output/

      - name: Verify and rename PDF
        run: |
          if [ -f docs_output/Agentic_Workflow_Handout.pdf ]; then
            echo "PDF successfully created"
            # Rename to sensible kebab-case filename
            mv docs_output/Agentic_Workflow_Handout.pdf docs_output/agentic-workflow-handout.pdf
            ls -lh docs_output/agentic-workflow-handout.pdf
          else
            echo "ERROR: PDF was not created"
            exit 1
          fi

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: agentic-workflow-handout
          path: docs_output/agentic-workflow-handout.pdf
          retention-days: 90

      - name: Cleanup build artifacts
        if: always()
        run: |
          rm -rf docs_output/*.aux docs_output/*.log docs_output/*.toc \
                 docs_output/*.out docs_output/*.fls docs_output/*.fdb_latexmk \
                 2>/dev/null || true
