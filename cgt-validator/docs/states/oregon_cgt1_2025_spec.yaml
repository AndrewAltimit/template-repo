# Oregon CGT-1 2025 Template Specification
# This file can be used programmatically by validators
# Last Updated: 2025-08-05

template:
  version: "5.0"
  date: "June 2025"
  state: "oregon"
  type: "CGT-1"

sheets:
  required:
    - name: "1. Cover Page"
      data_start_row: null  # Special structure
      validation_type: "sparse"

    - name: "2. TME_ALL"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "3. TME_PROV"
      data_start_row: 13
      field_codes_row: 10
      data_types_row: 11
      column_names_row: 12

    - name: "4. TME_UNATTR"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "5. MARKET_ENROLL"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "6. RX_MED_PROV"
      data_start_row: 13
      field_codes_row: 10
      data_types_row: 11
      column_names_row: 12

    - name: "7. RX_MED_UNATTR"
      data_start_row: 13
      field_codes_row: 10
      data_types_row: 11
      column_names_row: 12

    - name: "8. RX_REBATE"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "9. PROV_ID"
      data_start_row: 9
      field_codes_row: 6
      data_types_row: 7
      column_names_row: 8

  optional:
    - "Contents"
    - "Line of Business Code"
    - "Attribution Hierarchy Code"
    - "Demographic Tables"
    - "TME Validation"
    - "RX_MED_PROV Validation"
    - "RX_MED_UNATTR Validation"
    - "Provider Check"

field_mappings:
  "1. Cover Page":
    fields:
      - name: "Payer Name"
        position: [4, 2]  # row, column (0-indexed)
        required: true
        data_type: "text"

      - name: "Contact Name"
        position: [5, 2]
        required: true
        data_type: "text"

      - name: "Contact Email"
        position: [6, 2]
        required: true
        data_type: "email"

      - name: "Full Name"
        position: [11, 2]
        required: true
        data_type: "text"

      - name: "Title/Position"
        position: [12, 2]
        required: true
        data_type: "text"

      - name: "Email/Contact Information"
        position: [13, 2]
        required: true
        data_type: "text"

      - name: "Signature"
        position: [14, 2]
        required: true
        data_type: "text"

      - name: "Date"
        position: [15, 2]
        required: true
        data_type: "text"

  "3. TME_PROV":
    columns:
      - code: "TMEPRV01"
        name: "Reporting Year"
        data_type: "year"
        required: true

      - code: "TMEPRV02"
        name: "Line of Business Code"
        data_type: "code"
        required: true

      - code: "TMEPRV03"
        name: "Provider Organization Name"
        data_type: "free text, blank is not allowed"
        required: true

      - code: "TMEPRV04"
        name: "IPA or Contract Name\n(If applicable/available)"
        data_type: "free text, blank allowed"
        required: false

      - code: "TMEPRV06"
        name: "Attribution Hierarchy Code"
        data_type: "code"
        required: true

      - code: "TMEPRV07"
        name: "Member Months"
        data_type: "positive integer"
        required: true

      - code: "TMEPRV08"
        name: "Demographic Score"
        data_type: "non-negative number"
        required: true

  "9. PROV_ID":
    columns:
      - code: "PRV01"
        name: "Provider Organization Name"
        data_type: "free text"
        required: true

      - code: null  # No field code for IPA column
        name: "IPA or Contract Name (If applicable/available)"
        data_type: "free text"
        required: false

      - code: "PRV02"
        name: "Provider Organization TIN"
        data_type: "text, 9 digits including leading zero"
        required: true

validation_rules:
  - rule: "line_of_business_codes"
    applies_to: ["2. TME_ALL", "3. TME_PROV", "4. TME_UNATTR", "5. MARKET_ENROLL", "6. RX_MED_PROV", "7. RX_MED_UNATTR", "8. RX_REBATE"]
    field: "Line of Business Code"
    valid_values:
      1: "Medicare"
      2: "Medicaid"
      3: "Commercial: Full Claims"
      4: "Commercial: Partial Claims"
      5: "Medicare Expenses for Medicare/Medicaid Dual Eligible"
      6: "Medicaid Expenses for Medicare/Medicaid Dual Eligible"
      7: "CCO-F expenses or Medicaid Carve-Outs"

  - rule: "attribution_hierarchy_codes"
    applies_to: ["3. TME_PROV"]
    field: "Attribution Hierarchy Code"
    valid_values:
      1: "Tier 1: Member Selection"
      2: "Tier 2: Contract Arrangement"
      3: "Tier 3: Utilization"

  - rule: "tin_format"
    applies_to: ["9. PROV_ID"]
    field: "Provider Organization TIN"
    pattern: "^\\d{9}$"
    message: "TIN must be exactly 9 digits including leading zeros"

  - rule: "member_months_threshold"
    applies_to: ["3. TME_PROV"]
    field: "Member Months"
    threshold: 12
    severity: "warning"
    message: "Member months <= 12 should be rolled up to TME_UNATTR"

  - rule: "no_duplicate_combinations"
    applies_to: ["3. TME_PROV"]
    unique_key: ["Reporting Year", "Line of Business Code", "Provider Organization Name", "IPA or Contract Name\n(If applicable/available)", "Attribution Hierarchy Code"]
    message: "Duplicate Year-LOB-Provider-IPA-Attribution combinations found. All costs must be rolled up to a single line."

  - rule: "provider_name_reference"
    cross_reference:
      from_sheet: "3. TME_PROV"
      from_field: "Provider Organization Name"
      to_sheet: "9. PROV_ID"
      to_field: "Provider Organization Name"
    message: "Provider Organization Name not found in PROV_ID sheet"

  - rule: "provider_ipa_combination_reference"
    cross_reference:
      from_sheet: "3. TME_PROV"
      from_fields: ["Provider Organization Name", "IPA or Contract Name\n(If applicable/available)"]
      to_sheet: "9. PROV_ID"
      to_fields: ["Provider Organization Name", "IPA or Contract Name (If applicable/available)"]
    message: "Provider-IPA combination not found in PROV_ID sheet"

  - rule: "reporting_year"
    applies_to: ["2. TME_ALL", "3. TME_PROV", "4. TME_UNATTR", "5. MARKET_ENROLL", "6. RX_MED_PROV", "7. RX_MED_UNATTR", "8. RX_REBATE"]
    field: "Reporting Year"
    validation: "current_or_previous_year"
    message: "Reporting year must be current year or previous year"

data_type_mappings:
  "year":
    python_type: "int"
    validation: "current_or_previous_year"

  "code":
    python_type: "int"
    validation: "in_allowed_values"

  "positive integer":
    python_type: "int"
    validation: "greater_than_zero"

  "non-negative number":
    python_type: "float"
    validation: "greater_or_equal_zero"

  "free text":
    python_type: "str"
    validation: "any"

  "free text, blank is not allowed":
    python_type: "str"
    validation: "non_empty"

  "free text, blank allowed":
    python_type: "str"
    validation: "any"

  "text, 9 digits including leading zero":
    python_type: "str"
    validation: "regex:^\\d{9}$"
    format_as: "text"  # Important for Excel
