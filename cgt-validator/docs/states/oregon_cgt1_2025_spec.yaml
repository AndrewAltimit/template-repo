# Oregon CGT-1 2025 Template Specification
# This file can be used programmatically by validators
# Last Updated: 2025-08-05

template:
  version: "5.0"
  date: "June 11, 2025"
  state: "oregon"
  type: "CGT-1"
  # Documentation section for non-programmable rules
  documentation:
    - "This specification enforces file structure and data format rules."
    - "Data Sourcing Rule (Not Validated): Payers must include Oregon university student health plan members as Oregon residents for the duration of their plan coverage."
    - "Data Sourcing Rule (Not Validated): Exclude out-of-state residents treated in Oregon - focus is on Oregon residents only."
    - "Data Sourcing Rule (Not Validated): For LOBs 5 & 6 (Medicare/Medicaid Dual Eligible), financial data should be based on 'Paid Amounts' not 'Allowed Amounts', regardless of whether the payer is primary or secondary."
    - "Data Sourcing Rule (Not Validated): Payers using Tier 3 attribution (Utilization) must provide a summary of their methodology on the Cover Page."
    - "Reporting Rule: Non-claims payments for provider performance must be assigned to the year the performance was tracked."
    - "Reporting Rule: Costs previously reported under 'Provider Salaries' should now be reported under 'Non-Claims Other'."
    - "Reporting Rule: HRSN costs are only to be included in the TME_UNATTR and TME_ALL tabs."
    - "Process Rule: An authorized signer must certify every data submission and resubmission."
    - "Calculation Rule: Cost growth by market at statewide level is reported on a per capita basis, not PMPM."
    - "Attribution Rule: Non-claims dollars should be attributed at the member level before rolling up to provider organization."

sheets:
  required:
    - name: "1. Cover Page"
      data_start_row: null  # Special structure
      validation_type: "sparse"

    - name: "2. TME_ALL"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "3. TME_PROV"
      data_start_row: 13
      field_codes_row: 10
      data_types_row: 11
      column_names_row: 12

    - name: "4. TME_UNATTR"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "5. MARKET_ENROLL"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "6. RX_MED_PROV"
      data_start_row: 13
      field_codes_row: 10
      data_types_row: 11
      column_names_row: 12

    - name: "7. RX_MED_UNATTR"
      data_start_row: 13
      field_codes_row: 10
      data_types_row: 11
      column_names_row: 12

    - name: "8. RX_REBATE"
      data_start_row: 11
      field_codes_row: 8
      data_types_row: 9
      column_names_row: 10

    - name: "9. PROV_ID"
      data_start_row: 9
      field_codes_row: 6
      data_types_row: 7
      column_names_row: 8

  optional:
    - "Contents"
    - "Demographic Tables"
    - "TME Validation"
    - "RX_MED_PROV Validation"
    - "RX_MED_UNATTR Validation"
    - "Provider Check"

field_mappings:
  "1. Cover Page":
    fields:
      - name: "Payer Name"
        position: [4, 2]  # row, column (0-indexed)
        required: true
        data_type: "text"

      - name: "Contact Name"
        position: [5, 2]
        required: true
        data_type: "text"

      - name: "Contact Email"
        position: [6, 2]
        required: true
        data_type: "email"

      - name: "Full Name"
        position: [11, 2]
        required: true
        data_type: "text"

      - name: "Title/Position"
        position: [12, 2]
        required: true
        data_type: "text"

      - name: "Email/Contact Information"
        position: [13, 2]
        required: true
        data_type: "text"

      - name: "Signature"
        position: [14, 2]
        required: true
        data_type: "text"

      - name: "Date"
        position: [15, 2]
        required: true
        data_type: "text"

  "2. TME_ALL":
    columns:
      - code: "TMEALL01"
        name: "Reporting Year"
        data_type: "year"
        required: true

      - code: "TMEALL02"
        name: "Line of Business Code"
        data_type: "code"
        required: true

      - code: "TMEALL03"
        name: "Member Months"
        data_type: "positive integer"
        required: true

      - code: "TMEALL04"
        name: "Demographic Score"
        data_type: "non-negative number"
        required: true

  "3. TME_PROV":
    columns:
      - code: "TMEPRV01"
        name: "Reporting Year"
        data_type: "year"
        required: true

      - code: "TMEPRV02"
        name: "Line of Business Code"
        data_type: "code"
        required: true

      - code: "TMEPRV03"
        name: "Provider Organization Name"
        data_type: "free text, blank is not allowed"
        required: true

      - code: "TMEPRV04"
        name: "IPA or Contract Name\n(If applicable/available)"
        data_type: "free text, blank allowed"
        required: true  # Field is required for dual-level attribution (Version 5.0 change)

      - code: "TMEPRV06"
        name: "Attribution Hierarchy Code"
        data_type: "code"
        required: true

      - code: "TMEPRV07"
        name: "Member Months"
        data_type: "positive integer"
        required: true

      - code: "TMEPRV08"
        name: "Demographic Score"
        data_type: "non-negative number"
        required: true

  "8. RX_REBATE":
    columns:
      - code: "RXR01"
        name: "Reporting Year"
        data_type: "year"
        required: true

      - code: "RXR02"
        name: "Line of Business Code"
        data_type: "code"
        required: true

      - code: "RXR03"
        name: "Medical Pharmacy Rebate Amount"
        data_type: "non-positive number"
        required: false  # Can be zero or negative

      - code: "RXR04"
        name: "Retail Pharmacy Rebate Amount"
        data_type: "non-positive number"
        required: false

      - code: "RXR05"
        name: "Total Pharmacy Rebate Amount (Optional)"
        data_type: "non-positive number"
        required: false

  "9. PROV_ID":
    columns:
      - code: "PRV01"
        name: "Provider Organization Name"
        data_type: "free text"
        required: true

      - code: null  # No field code for IPA column
        name: "IPA or Contract Name (If applicable/available)"
        data_type: "free text, blank allowed"
        required: false  # Field is required but value can be blank

      - code: "PRV02"
        name: "Provider Organization TIN"
        data_type: "text, 9 digits including leading zero"
        required: true

validation_rules:
  - rule: "line_of_business_codes_all"
    applies_to: ["2. TME_ALL"]
    field: "Line of Business Code"
    valid_values:
      1: "Medicare"
      2: "Medicaid"
      3: "Commercial: Full Claims"
      4: "Commercial: Partial Claims"
      5: "Medicare Expenses for Medicare/Medicaid Dual Eligible"
      6: "Medicaid Expenses for Medicare/Medicaid Dual Eligible"
      7: "CCO-F and Medicaid Open Card Carve-Outs"
    message: "LOB Code in TME_ALL must be 1-7."

  - rule: "line_of_business_codes_standard"
    applies_to: ["3. TME_PROV", "4. TME_UNATTR", "5. MARKET_ENROLL", "6. RX_MED_PROV", "7. RX_MED_UNATTR", "8. RX_REBATE"]
    field: "Line of Business Code"
    valid_values:
      1: "Medicare"
      2: "Medicaid"
      3: "Commercial: Full Claims"
      4: "Commercial: Partial Claims"
      5: "Medicare Expenses for Medicare/Medicaid Dual Eligible"
      6: "Medicaid Expenses for Medicare/Medicaid Dual Eligible"
    message: "LOB Code must be 1-6 for this sheet. LOB 7 is only allowed in TME_ALL."

  - rule: "attribution_hierarchy_codes"
    applies_to: ["3. TME_PROV"]
    field: "Attribution Hierarchy Code"
    valid_values:
      1: "Tier 1: Member Selection"
      2: "Tier 2: Contract Arrangement"
      3: "Tier 3: Utilization (requires methodology summary on Cover Page)"

  - rule: "tin_format"
    applies_to: ["9. PROV_ID"]
    field: "Provider Organization TIN"
    pattern: "^\\d{9}$"
    message: "TIN must be exactly 9 digits including leading zeros"

  - rule: "member_months_threshold"
    applies_to: ["3. TME_PROV"]
    field: "Member Months"
    threshold: 12
    severity: "warning"
    message: "Member months <= 12 should be rolled up to TME_UNATTR"

  - rule: "no_duplicate_combinations"
    applies_to: ["3. TME_PROV"]
    unique_key: ["Reporting Year", "Line of Business Code", "Provider Organization Name", "IPA or Contract Name\n(If applicable/available)", "Attribution Hierarchy Code"]
    message: "Duplicate Year-LOB-Provider-IPA-Attribution combinations found. All costs must be rolled up to a single line."

  - rule: "provider_name_reference"
    cross_reference:
      from_sheet: "3. TME_PROV"
      from_field: "Provider Organization Name"
      to_sheet: "9. PROV_ID"
      to_field: "Provider Organization Name"
    message: "Provider Organization Name not found in PROV_ID sheet"

  - rule: "provider_ipa_combination_reference"
    cross_reference:
      from_sheet: "3. TME_PROV"
      from_fields: ["Provider Organization Name", "IPA or Contract Name\n(If applicable/available)"]
      to_sheet: "9. PROV_ID"
      to_fields: ["Provider Organization Name", "IPA or Contract Name (If applicable/available)"]
    message: "Provider-IPA combination not found in PROV_ID sheet. Note: Validator should handle newline characters in column names."

  - rule: "reporting_year"
    applies_to: ["2. TME_ALL", "3. TME_PROV", "4. TME_UNATTR", "5. MARKET_ENROLL", "6. RX_MED_PROV", "7. RX_MED_UNATTR", "8. RX_REBATE"]
    field: "Reporting Year"
    validation: "current_or_previous_year"
    message: "Reporting year must be current year or previous year"

  - rule: "pharmacy_rebates_are_negative"
    applies_to: ["8. RX_REBATE"]
    fields: ["Medical Pharmacy Rebate Amount", "Retail Pharmacy Rebate Amount", "Total Pharmacy Rebate Amount (Optional)"]
    validation: "is_non_positive"
    message: "Pharmacy rebate amounts must be reported as a negative number or zero."

  - rule: "hrsn_costs_location"
    applies_to: ["3. TME_PROV"]
    validation: "field_empty_in_sheets"
    field: "Non-Claims: HRSN"
    message: "HRSN costs should only be reported in the TME_ALL and TME_UNATTR tabs, not in TME_PROV."
    severity: "error"

  - rule: "non_claims_performance_year"
    severity: "manual_check"
    message: "Manual verification needed to ensure non-claims performance payments are reported for the year the performance occurred."

  - rule: "ipa_required_for_dual_attribution"
    applies_to: ["3. TME_PROV"]
    field: "IPA or Contract Name\n(If applicable/available)"
    validation: "required_for_dual_attribution"
    message: "IPA or Contract Name is required when members can be attributed at both provider organization and IPA/Contract level."
    severity: "warning"

data_type_mappings:
  "year":
    python_type: "int"
    validation: "current_or_previous_year"

  "code":
    python_type: "int"
    validation: "in_allowed_values"

  "positive integer":
    python_type: "int"
    validation: "greater_than_zero"

  "non-negative number":
    python_type: "float"
    validation: "greater_or_equal_zero"

  "non-positive number":
    python_type: "float"
    validation: "less_or_equal_zero"

  "free text":
    python_type: "str"
    validation: "any"

  "free text, blank is not allowed":
    python_type: "str"
    validation: "non_empty"

  "free text, blank allowed":
    python_type: "str"
    validation: "any"

  "text, 9 digits including leading zero":
    python_type: "str"
    validation: "regex:^\\d{9}$"
    format_as: "text"  # Important for Excel
